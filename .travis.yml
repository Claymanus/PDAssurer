env:
  global: 
    - NSS_DEFAULT_DB_TYPE="sql"
    - I_DONT_MIND_IF_MY_CHROME_PKI_DATABASE_GETS_DELETED=true
    - secure: "AgFID7Zfh65cwfqveYJXUT8q7xcBDA6+gNCmV90ihmvips5Uxrb7aGHQYVxPPGQy1pbv2fMnxWHjj5HR7gVp9W06HhN6kTqseGYABPWk0Tmyd0rNdDcvSMfXx9yy4jc+f2tqdmMcNOhdJ+feBaFq7uZOkqlTndkdD8m1XBMZUVs="
before_install:
- ./tools/setupdoc
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- cp /etc/apt/sources.list /tmp
- echo deb http://de.archive.ubuntu.com/ubuntu/ trusty main restricted universe >/tmp/sources.list
- echo deb http://de.archive.ubuntu.com/ubuntu/ trusty-updates main restricted universe >>/tmp/sources.list
- sudo cp /tmp/sources.list /etc/apt
- cp /etc/hosts /tmp
- echo "127.0.0.1 local.sso.edemokraciagep.org" >>/tmp/hosts
- sudo cp /tmp/hosts /etc/hosts
- sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 3B4FE6ACC0B21F32 40976EAF437D05B5
- sudo apt-get --purge remove postgresql-common ant ant-contrib ant-optional autoconf automake autotools-dev binutils binutils-doc bison ca-certificates ca-certificates-java ccache chromium-codecs-ffmpeg-extra comerr-dev console-setup curl dh-apparmor dosfstools eject emacsen-common firefox-locale-en flex fontconfig fontconfig-config fuse gawk gir1.2-gtk-2.0 gir1.2-rsvg-2.0 git-man gpgv groff-base guile-1.8-libs hdparm hicolor-icon-theme html2text icedtea-6-plugin icedtea-7-plugin icedtea-netx icedtea-netx-common imagemagick-common insserv iso-codes ivy java-common jsvc language-pack-en language-pack-en-base libalgorithm-diff-perl libapr1 libasn1-8-heimdal libasyncns0 libatk-wrapper-java libaudio2 libavahi-client3 libavahi-common-data libavahi-common3 libavahi-glib1 libbison-dev libbsd0 libbz2-1.0 libbz2-dev libc-dev-bin libc6-dev libcanberra-gtk3-0 libcanberra-gtk3-module libcanberra0 libcap2 libck-connector0 libclass-isa-perl libcommons-daemon-java libcroco3 libcurl3 libcurl4-openssl-dev libdap11 libdapclient3 libdatrie1 libdb5.1 libdbus-1-3 libdbus-glib-1-2 libdjvulibre-dev libdjvulibre-text libdjvulibre21 libdrm-dev libdrm-intel1 libdrm-nouveau2 libdrm-radeon1 libdrm2 libedit2 libelf1 liberror-perl libevent-2.0-5 libexif-dev libexif12 libexpat1 libexpat1-dev libffi-dev libffi6 libfile-desktopentry-perl libfile-mimeinfo-perl libfl-dev libflac8 libfontconfig1 libfontconfig1-dev libfontenc1 libfreetype6 libfreetype6-dev libfreexl1 libfribidi0 libfuse2 libgcrypt11 libgcrypt11-dev libgdbm-dev libgdbm3 libgif4 libglib2.0-data libglu1-mesa libglu1-mesa-dev libgmp10 libgnome-keyring-common libgnome-keyring0 libgnome2-bin libgnome2-common libgnomevfs2-common libgpg-error-dev libgpg-error0 libgpm2 libgssapi3-heimdal libgtk2.0-common libhcrypto4-heimdal libhdf4-0-alt libheimbase1-heimdal libheimntlm0-heimdal libhtml-template-perl libhx509-5-heimdal libice-dev libice6 libidl-common libidl0 libidn11 libidn11-dev libijs-0.35 libilmbase-dev libilmbase6 libjasper-dev libjasper1 libjbig2dec0 libjpeg-dev libjpeg-turbo8 libjpeg-turbo8-dev libjpeg8 libjpeg8-dev libjs-jquery libkeyutils1 libkrb5-26-heimdal liblcms1 liblcms1-dev liblcms2-2 liblockfile-bin liblockfile1 liblqr-1-0 liblqr-1-0-dev libltdl-dev libltdl7 liblzma5 libmagic1 libmozjs185-1.0 libmpfr4 libmysql++-dev libmysql++3 libmysqlclient-dev libmysqlclient18 libncurses5-dev libncursesw5 libncursesw5-dev libnettle4 libnewt0.52 libnfnetlink0 libnih-dbus1 libnih1 libnspr4 libodbc1 libogg0 libopenexr-dev libopenexr6 liborc-0.4-0 libossp-uuid-dev libossp-uuid16 libp11-kit-dev libp11-kit0 libpam-ck-connector libpaper-utils libpaper1 libparted0debian1 libpciaccess0 libpcre3 libpcre3-dev libpcrecpp0 libpcsclite1 libpgm-5.1-0 libpipeline1 libpixman-1-0 libpixman-1-dev libpng12-0 libpng12-dev libpopt0 libpq-dev libpq5 libpthread-stubs0-dev libreadline-dev libreadline5 libreadline6 libreadline6-dev libroken18-heimdal libsctp1 libsgutils2-2 libsigsegv2 libsm-dev libsm6 libsndfile1 libsqlite3-0 libsqlite3-dev libssl-dev libssl-doc libssl0.9.8 libssl1.0.0 libstartup-notification0 libsys-hostname-long-perl libtdb1 libthai-data libthai0 libtimedate-perl libtinfo-dev libunistring0 libusb-0.1-4 libvorbis0a libvorbisenc2 libvorbisfile3 libwind0-heimdal libwmf-dev libwmf0.2-7 libwrap0 libx11-6 libx11-data libx11-dev libx11-doc libx11-xcb1 libxau-dev libxau6 libxaw7 libxcb-glx0 libxcb-render0 libxcb-render0-dev libxcb-shape0 libxcb-shm0 libxcb-shm0-dev libxcb-util0 libxcb1 libxcb1-dev libxcomposite-dev libxcomposite1 libxcursor-dev libxcursor1 libxdamage-dev libxdamage1 libxdmcp-dev libxdmcp6 libxerces2-java libxext-dev libxext6 libxfont1 libxft-dev libxft2 libxinerama-dev libxinerama1 libxkbfile1 libxml-commons-external-java libxml-commons-resolver1.1-java libxml2 libxml2-dev libxml2-utils libxmlrpc-core-c3 libxmu6 libxmuu1 libxpm4 libxrandr-dev libxrandr2 libxrender-dev libxrender1 libxslt1-dev libxslt1.1 libxss1 libxt-dev libxt6 libxtst6 libxv1 libxxf86dga1 libxxf86vm1 libyaml-0-2 libyaml-dev libzmq3 linux-libc-dev lksctp-tools locales lockfile-progs logrotate lsof m4 make makedev man-db manpages manpages-dev md5deep memcached mime-support mingw32-binutils mongodb-10gen mtools multiarch-support mysql-client mysql-client-5.5 mysql-client-core-5.5 mysql-common mysql-server net-tools netcat-openbsd notification-daemon ntpdate odbcinst odbcinst1debian2 openjdk-6-jre-lib openssl oracle-java7-installer oracle-java8-installer patch pkg-config policykit-1-gnome postgresql-9.1-postgis-scripts postgresql-9.2-postgis-scripts postgresql-9.3-postgis-scripts postgresql-9.4-postgis-scripts postgresql-client postgresql-client-9.1 postgresql-client-9.2 postgresql-client-9.3 postgresql-client-9.4 postgresql-client-common powermgmt-base psmisc python-configobj python-httplib2 python-launchpadlib python-lazr.restfulclient python-lazr.uri python-oauth python-paramiko python-pkg-resources python-software-properties python-wadllib python-zope.interface ragel readline-common redis-server resolvconf rsync scons sgml-base sound-theme-freedesktop sqlite3 sqlite3-doc ssl-cert strace sudo sysv-rc sysvinit-utils telnet tzdata-java ucf unzip ureadahead vim vim-common vim-runtime vim-tiny wget whiptail x11-common x11-utils x11-xkb-utils x11-xserver-utils x11proto-core-dev x11proto-fixes-dev x11proto-input-dev x11proto-kb-dev x11proto-randr-dev x11proto-xext-dev xauth xdg-utils xfonts-utils xkb-data xml-core xorg-sgml-doctools xserver-common xtrans-dev zip zlib1g-dev
- sudo apt-get update
- sudo DEBIAN_FRONTEND=noninteractive apt-get -o Dpkg::Options::="--force-confold" --force-yes -fuy upgrade
- sudo apt-get -y install python make python-pip firefox openjdk-7-jre curl docbook-xsl apache2 libapache2-mod-wsgi swig chromium-browser chromium-chromedriver libnss3-tools
- sudo cp src/end2endtest/certs.json /etc/chromium-browser/policies/managed/
- sudo pip install -r requirements.txt
script:
- make checkall
- ./tools/commitdocs
